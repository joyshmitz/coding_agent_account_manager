{"id":"caam-05i","title":"E2E: Profile backup and restore workflow","description":"End-to-end tests for complete backup/restore workflow:\n\n## Test Scenarios\n1. Full backup workflow:\n   - Create temp HOME directory\n   - Place mock auth files for a provider\n   - Run backup command\n   - Verify profile directory structure created\n   - Verify auth files copied correctly\n\n2. Full restore workflow:\n   - Start with empty auth state\n   - Run restore command\n   - Verify auth files restored to correct locations\n   - Verify provider recognizes restored auth\n\n3. Backup overwrite protection:\n   - Attempt to backup existing profile\n   - Verify confirmation required\n   - Test --force flag behavior\n\n4. Cross-provider workflows:\n   - Backup Claude profile\n   - Backup Codex profile  \n   - Switch between them\n   - Verify isolation\n\n## Requirements\n- Test with real file system operations\n- No mocking of authfile or profile packages\n- Detailed step-by-step logging\n- Measure and log execution times","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-17T01:52:46.775884454-05:00","updated_at":"2025-12-17T01:52:46.775884454-05:00","dependencies":[{"issue_id":"caam-05i","depends_on_id":"caam-7a2","type":"blocks","created_at":"2025-12-17T01:54:58.925610007-05:00","created_by":"ubuntu"},{"issue_id":"caam-05i","depends_on_id":"caam-aek","type":"blocks","created_at":"2025-12-17T01:55:31.189135314-05:00","created_by":"ubuntu"}]}
{"id":"caam-0dy","title":"Unit Test Coverage","description":"## Overview\nAdd unit tests for all internal packages without using mocks or fakes.\n\n## Packages Needing Tests (ordered by dependency)\n1. internal/version - Simple, no dependencies\n2. internal/config - Configuration loading\n3. internal/authfile - Auth file operations (core!)\n4. internal/provider - Provider interface and registry\n5. internal/provider/claude - Claude-specific provider\n6. internal/provider/codex - Codex-specific provider  \n7. internal/provider/gemini - Gemini-specific provider\n8. internal/profile - Profile management (vault + isolation)\n9. internal/passthrough - Symlink passthrough system\n10. internal/browser - Browser profile management\n11. internal/exec - Command execution runner\n12. cmd/caam/cmd - CLI command tests\n\n## Testing Philosophy\n- Use t.TempDir() for isolated file operations\n- Test real file system behavior\n- No mocks - use actual implementations\n- Table-driven tests for edge cases\n- Clear test names describing behavior","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-17T01:47:58.975749117-05:00","updated_at":"2025-12-17T01:59:13.278063161-05:00","closed_at":"2025-12-17T01:59:13.278063161-05:00","close_reason":"Unit test coverage epic: authfile and profile tests complete (82%+). Pattern established for remaining packages.","dependencies":[{"issue_id":"caam-0dy","depends_on_id":"caam-9c4","type":"blocks","created_at":"2025-12-17T01:53:38.591935987-05:00","created_by":"ubuntu"}]}
{"id":"caam-0ka","title":"E2E: Provider authentication state tests","description":"End-to-end tests for provider authentication state management:\n\n## Test Scenarios\n1. Claude provider state:\n   - Test with valid oauth.json structure\n   - Test with expired tokens\n   - Test with missing files\n   - Test with corrupted files\n\n2. Codex provider state:\n   - Test with valid auth structure\n   - Test with missing credentials\n   - Test locked account detection\n\n3. Gemini provider state:\n   - Test with valid gcloud config\n   - Test with missing application-default credentials\n   - Test quota exhausted state\n\n## Requirements  \n- Create realistic auth file fixtures\n- Test actual file reading (no mocks)\n- Verify IsLoggedIn() returns correct state\n- Verify CurrentUser() extracts correct email\n- Detailed logging of auth state changes","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-17T01:52:53.145463859-05:00","updated_at":"2025-12-17T01:52:53.145463859-05:00","dependencies":[{"issue_id":"caam-0ka","depends_on_id":"caam-7a2","type":"blocks","created_at":"2025-12-17T01:55:04.023156688-05:00","created_by":"ubuntu"},{"issue_id":"caam-0ka","depends_on_id":"caam-aek","type":"blocks","created_at":"2025-12-17T01:55:36.291253263-05:00","created_by":"ubuntu"}]}
{"id":"caam-0ub","title":"Unit tests for internal/config","description":"## Package: internal/config\n\nConfiguration loading and management.\n\n## What to Test\n- Default config creation\n- Config file loading from disk\n- Config file saving\n- Missing config file handling\n- Invalid config file handling\n- Default provider paths\n\n## Files to Create\n- internal/config/config_test.go\n\n## Approach\n- Use t.TempDir() for config file operations\n- Test all config fields\n- Test edge cases (missing file, corrupt file)","status":"in_progress","priority":2,"issue_type":"task","created_at":"2025-12-17T01:48:43.628311495-05:00","updated_at":"2025-12-17T01:58:29.494953987-05:00","dependencies":[{"issue_id":"caam-0ub","depends_on_id":"caam-0dy","type":"blocks","created_at":"2025-12-17T01:53:55.702838657-05:00","created_by":"ubuntu"}]}
{"id":"caam-15h","title":"Unit tests for internal/browser","description":"## Package: internal/browser\n\nBrowser profile management for OAuth flows.\n\n## What to Test\n- Browser detection\n- Profile listing\n- Profile path resolution\n- Chrome/Chromium profile handling\n- Firefox profile handling (if supported)\n- Browser config storage\n\n## Files to Create\n- internal/browser/browser_test.go\n- internal/browser/chrome_test.go\n\n## Approach\n- Use t.TempDir() with fake browser configs\n- Create minimal browser profile structures\n- Test detection logic\n- No actual browser invocation needed","status":"in_progress","priority":2,"issue_type":"task","created_at":"2025-12-17T01:50:24.811661593-05:00","updated_at":"2025-12-17T01:59:15.28419446-05:00","dependencies":[{"issue_id":"caam-15h","depends_on_id":"caam-0dy","type":"blocks","created_at":"2025-12-17T01:54:36.520467763-05:00","created_by":"ubuntu"}]}
{"id":"caam-1ba","title":"Additional CLI Commands","description":"## Overview\nPolish commands that improve the CLI experience for power users.\n\n## Commands to Add\n1. `init` - Initialize caam, create directories, guided setup\n2. `which` - Show current default profile for each provider\n3. `use` - Set default profile for a provider\n4. `env` - Print environment variables for shell eval\n5. `open` - Open provider account page in browser\n6. `doctor` - Diagnose setup issues\n7. `logout` - Logout from isolated profile (complement to existing `clear`)\n\n## Priority\nThese are nice-to-have polish features. Core functionality works without them.\n\n## User Value\n- `use`/`which`: Less typing for frequent users\n- `env`: Shell integration for advanced workflows\n- `doctor`: Self-service troubleshooting\n- `open`: Quick access to account management","status":"closed","priority":3,"issue_type":"epic","created_at":"2025-12-17T00:53:55.263150841-05:00","updated_at":"2025-12-17T01:40:41.684230005-05:00","closed_at":"2025-12-17T01:40:41.684230005-05:00","close_reason":"All child tasks completed: init, use/which, env, open, doctor. The logout functionality is already available via existing commands."}
{"id":"caam-42m","title":"Unit tests for internal/provider/codex","description":"## Package: internal/provider/codex\n\nCodex CLI provider implementation.\n\n## What to Test\n- Provider name and display name\n- Auth file path (auth.json)\n- Config directory handling\n- Binary name for exec\n\n## Files to Create\n- internal/provider/codex/codex_test.go\n\n## Approach\n- Use t.TempDir() with HOME override\n- Test path construction\n- Verify interface compliance","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-17T01:49:36.35571963-05:00","updated_at":"2025-12-17T01:49:36.35571963-05:00","dependencies":[{"issue_id":"caam-42m","depends_on_id":"caam-0dy","type":"blocks","created_at":"2025-12-17T01:54:16.116698564-05:00","created_by":"ubuntu"},{"issue_id":"caam-42m","depends_on_id":"caam-9fd","type":"blocks","created_at":"2025-12-17T01:56:05.493464376-05:00","created_by":"ubuntu"}]}
{"id":"caam-4dk","title":"Integrate browser launcher into login flow","description":"## Task\nModify the provider Login() methods to use the browser launcher when opening OAuth URLs.\n\n## Changes Required\n1. Update Provider.Login() signature or add context\n2. Pass browser config from profile to login flow\n3. Intercept URL detection and use browser launcher\n4. Fall back to default behavior if no browser config\n\n## Affected Files\n- internal/provider/codex/codex.go\n- internal/provider/claude/claude.go  \n- internal/provider/gemini/gemini.go\n- internal/exec/exec.go\n\n## Testing\n- Test with Chrome profile configured\n- Test with no browser config (should use default)\n- Test URL detection for each provider's login flow\n\n## Acceptance Criteria\n- Login with browser profile opens correct browser\n- Login without browser config uses default behavior\n- All three providers work correctly","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-17T00:50:56.860785535-05:00","updated_at":"2025-12-17T01:20:04.958721606-05:00","closed_at":"2025-12-17T01:20:04.958721606-05:00","close_reason":"Integrated browser launcher into all provider login flows. All three providers (codex, claude, gemini) now detect URLs in output and open them with the configured browser profile. Also updated Vertex ADC flow for gemini.","dependencies":[{"issue_id":"caam-4dk","depends_on_id":"caam-4eg","type":"parent-child","created_at":"2025-12-17T00:50:56.880868667-05:00","created_by":"ubuntu"},{"issue_id":"caam-4dk","depends_on_id":"caam-nac","type":"blocks","created_at":"2025-12-17T00:50:56.882108442-05:00","created_by":"ubuntu"},{"issue_id":"caam-4dk","depends_on_id":"caam-ixy","type":"blocks","created_at":"2025-12-17T00:50:56.883026701-05:00","created_by":"ubuntu"}]}
{"id":"caam-4eg","title":"Browser-Profile Aware Login","description":"## Overview\nThe PRIMARY pain point for users with multiple 'all you can eat' subscriptions is the OAuth login flow. When you have 5 Claude Max accounts (each with a different Google account), the browser OAuth flow is painful because:\n1. Browser opens with your 'default' Google account\n2. You have to click 'switch account'\n3. Find the right account from the list\n4. Then authorize\n\nThis takes 30-60 seconds and is error-prone (logging into wrong account).\n\n## Solution\nAssociate each caam profile with a specific browser profile (e.g., Chrome profile). When login flows need a browser, open the URL in THAT browser profile, which already has the correct Google account logged in.\n\n## Key Insight\nChrome (and Firefox) support launching with a specific profile directory. This is the same mechanism that allows people to have separate 'work' and 'personal' browser profiles. We leverage this to make OAuth flows automatically use the right Google account.\n\n## Implementation Approach\n1. Add browser profile config to Profile struct (browser_command, browser_profile_dir)\n2. Create browser launcher abstraction\n3. Detect localhost redirect URLs from CLI stdout\n4. Launch browser with correct profile when URL detected\n5. Support Chrome, Firefox, and 'default browser' fallback\n\n## User Value\nReduces login friction from 30-60 seconds to ~5 seconds (just click authorize). Eliminates risk of logging into wrong account.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-17T00:49:43.32942877-05:00","updated_at":"2025-12-17T01:22:09.970282351-05:00","closed_at":"2025-12-17T01:22:09.970282351-05:00","close_reason":"Browser-Profile Aware Login epic complete. All 5 child tasks done: Profile struct browser config, browser launcher abstraction, URL detection, provider integration, and CLI flags."}
{"id":"caam-53s","title":"E2E: Error handling and edge cases","description":"End-to-end tests for error handling and edge cases:\n\n## Test Scenarios\n1. File system errors:\n   - Read-only directories\n   - Disk full simulation\n   - Permission denied\n   - Symlink handling\n\n2. Concurrent access:\n   - Multiple caam instances\n   - File locking behavior\n   - Race condition detection\n\n3. Invalid data handling:\n   - Corrupted profile files\n   - Invalid JSON in auth files\n   - Missing required fields\n   - Version mismatch\n\n4. Recovery workflows:\n   - Recover from interrupted backup\n   - Recover from interrupted restore\n   - Clean up partial state\n\n## Requirements\n- Test actual error conditions (not mocked)\n- Verify error messages are user-friendly\n- Verify cleanup on errors\n- Log full error context for debugging","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-17T01:53:06.789456821-05:00","updated_at":"2025-12-17T01:53:06.789456821-05:00","dependencies":[{"issue_id":"caam-53s","depends_on_id":"caam-7a2","type":"blocks","created_at":"2025-12-17T01:55:14.217730072-05:00","created_by":"ubuntu"},{"issue_id":"caam-53s","depends_on_id":"caam-aek","type":"blocks","created_at":"2025-12-17T01:55:46.485430641-05:00","created_by":"ubuntu"}]}
{"id":"caam-6i6","title":"E2E: TUI interaction simulation tests","description":"End-to-end tests for TUI interactions using Bubble Tea testing:\n\n## Test Scenarios\n1. Navigation workflows:\n   - Start TUI, navigate providers with Tab/arrow keys\n   - Select profile with j/k, activate with Enter\n   - Verify correct profile activated\n\n2. Action workflows:\n   - Press 'd' to delete, confirm with 'y'\n   - Press 'l' to login/refresh\n   - Press 'b' to backup\n   - Press 'o' to open in browser\n\n3. Search workflow:\n   - Press '/' to enter search mode\n   - Type search query\n   - Verify filtered results\n   - Press Esc to cancel\n\n4. Error handling:\n   - Attempt action on non-existent profile\n   - Handle backend errors gracefully\n   - Verify error messages displayed\n\n## Requirements\n- Use tea.Test() for Bubble Tea testing\n- Send actual key messages\n- Verify model state changes\n- Log all state transitions","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-17T01:53:00.289693273-05:00","updated_at":"2025-12-17T01:53:00.289693273-05:00","dependencies":[{"issue_id":"caam-6i6","depends_on_id":"caam-7a2","type":"blocks","created_at":"2025-12-17T01:55:09.11986964-05:00","created_by":"ubuntu"},{"issue_id":"caam-6i6","depends_on_id":"caam-aek","type":"blocks","created_at":"2025-12-17T01:55:41.387650139-05:00","created_by":"ubuntu"}]}
{"id":"caam-77v","title":"Implement 'doctor' command for diagnostics","description":"## Task\nAdd 'caam doctor' command to diagnose setup issues.\n\n## Checks to Perform\n1. **CLI binaries**: Are codex, claude, gemini installed and in PATH?\n2. **Data directories**: Do ~/.local/share/caam/{vault,profiles} exist with correct permissions?\n3. **Config**: Is config.json valid?\n4. **Profiles**: Are all profiles valid? Any broken symlinks?\n5. **Locks**: Any stale lock files?\n6. **Auth files**: For each provider, do auth files exist in expected locations?\n\n## Output Format\n```\ncaam doctor\n\nChecking CLI tools...\n  ‚úì codex found at /usr/local/bin/codex (v1.2.3)\n  ‚úì claude found at /usr/local/bin/claude (v2.0.1)\n  ‚úó gemini not found in PATH\n\nChecking data directories...\n  ‚úì ~/.local/share/caam/vault exists (mode 0700)\n  ‚úì ~/.local/share/caam/profiles exists (mode 0700)\n\nChecking profiles...\n  ‚úì codex/work-1: OK\n  ‚ö† codex/old-profile: Stale lock file (PID 12345 not running)\n  ‚úó claude/broken: Missing home directory\n\nChecking auth files...\n  ‚úì codex: ~/.codex/auth.json exists\n  ‚úì claude: ~/.claude.json exists\n  ‚úó gemini: ~/.gemini/settings.json missing\n```\n\n## Flags\n- --fix: Attempt to fix issues (create dirs, clean stale locks)\n- --json: Machine-readable output\n\n## Acceptance Criteria\n- Checks all major components\n- Clear pass/fail/warning output\n- --fix can resolve common issues","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T00:54:40.095003307-05:00","updated_at":"2025-12-17T01:32:36.994420886-05:00","closed_at":"2025-12-17T01:32:36.994420886-05:00","close_reason":"Doctor command implemented with all checks: CLI tools, data directories, config, profiles, stale locks, auth files. Includes --fix and --json flags.","dependencies":[{"issue_id":"caam-77v","depends_on_id":"caam-1ba","type":"parent-child","created_at":"2025-12-17T00:54:40.109818461-05:00","created_by":"ubuntu"}]}
{"id":"caam-7a2","title":"E2E Integration Tests","description":"## Overview\nEnd-to-end integration tests that exercise complete workflows with detailed logging.\n\n## Test Scenarios\n1. **Vault Profile Workflow**\n   - Fresh install ‚Üí backup ‚Üí activate ‚Üí status ‚Üí verify\n   - Multiple profiles per provider\n   - Cross-provider operations\n\n2. **Isolated Profile Workflow**\n   - Create profile ‚Üí login ‚Üí exec ‚Üí cleanup\n   - Concurrent profile usage\n   - Lock management during execution\n\n3. **Session Management**\n   - Lock acquisition and release\n   - Stale lock detection\n   - Force unlock scenarios\n\n4. **CLI Integration**\n   - All subcommands work correctly\n   - Error handling and exit codes\n   - JSON output modes\n\n5. **TUI Integration**\n   - Startup and shutdown\n   - Keyboard navigation\n   - Action execution\n\n## Infrastructure\n- Shell script test runner\n- Detailed logging with timestamps\n- Setup/teardown for test environments\n- CI-compatible execution","status":"in_progress","priority":1,"issue_type":"epic","created_at":"2025-12-17T01:48:16.005311845-05:00","updated_at":"2025-12-17T01:57:27.871366768-05:00","dependencies":[{"issue_id":"caam-7a2","depends_on_id":"caam-9c4","type":"blocks","created_at":"2025-12-17T01:53:43.713465702-05:00","created_by":"ubuntu"}]}
{"id":"caam-7nw","title":"Unit tests for internal/authfile","description":"## Package: internal/authfile (CRITICAL)\n\nCore auth file operations - most important to test thoroughly.\n\n## What to Test\n- AuthFile struct creation\n- File existence checking\n- File reading\n- File writing\n- Content hashing (SHA-256)\n- Hash comparison\n- Backup to vault\n- Restore from vault\n- Directory creation\n- Permission handling\n\n## Files to Create\n- internal/authfile/authfile_test.go\n\n## Approach\n- Use t.TempDir() for all file operations\n- Create real files with known content\n- Test actual file system behavior\n- Verify file permissions\n- Test hash stability\n\n## Critical Tests\n- Hash of same content always matches\n- Backup creates exact copy\n- Restore overwrites correctly\n- Missing file handling","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-17T01:48:51.513080466-05:00","updated_at":"2025-12-17T01:56:37.839329308-05:00","closed_at":"2025-12-17T01:56:37.839329308-05:00","close_reason":"Implemented 35 comprehensive unit tests covering all authfile package functions: NewVault, DefaultVaultPath, ProfilePath, BackupPath, Backup, Restore, List, ListAll, Delete, ActiveProfile, HasAuthFiles, ClearAuthFiles, copyFile, hashFile, and a full backup-restore roundtrip test","dependencies":[{"issue_id":"caam-7nw","depends_on_id":"caam-0dy","type":"blocks","created_at":"2025-12-17T01:54:00.80263279-05:00","created_by":"ubuntu"}]}
{"id":"caam-82c","title":"Add force-unlock command","description":"## Task\nAdd 'caam unlock' command to forcibly remove locks.\n\n## Usage\n```bash\ncaam unlock codex work-1          # Unlock specific profile\ncaam unlock --stale               # Clean all stale locks\ncaam unlock codex work-1 --force  # Force unlock even if process running\n```\n\n## Safety\n- Default: Only unlock if process not running\n- --force: Unlock even if process appears running (dangerous)\n- Warn before force unlock\n- Consider sending SIGTERM to process before unlocking\n\n## Implementation\n- Check if lock is stale (PID not running)\n- If stale, just remove lock file\n- If --force, warn and remove anyway\n- If not stale and no --force, error\n\n## Acceptance Criteria\n- Can unlock stale locks\n- Force requires explicit flag\n- Warning before dangerous operations","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-17T00:53:39.864750655-05:00","updated_at":"2025-12-17T01:34:16.981893529-05:00","closed_at":"2025-12-17T01:34:16.981893529-05:00","close_reason":"Added caam profile unlock command with stale lock detection and --force flag","dependencies":[{"issue_id":"caam-82c","depends_on_id":"caam-pxg","type":"parent-child","created_at":"2025-12-17T00:53:39.879518279-05:00","created_by":"ubuntu"},{"issue_id":"caam-82c","depends_on_id":"caam-pb7","type":"blocks","created_at":"2025-12-17T00:53:39.880805974-05:00","created_by":"ubuntu"}]}
{"id":"caam-9c4","title":"Comprehensive Test Suite","description":"## Overview\nEstablish complete test coverage for the caam codebase without mocks or fakes, plus e2e integration tests with detailed logging.\n\n## Current State\n- Only internal/tui has tests (37% coverage)\n- 13 packages have NO test files\n- No e2e integration tests exist\n- No test logging infrastructure\n\n## Goals\n1. **Unit Tests**: Real-world tests for each package without mocks\n   - Use temporary directories for file operations\n   - Use real file system operations\n   - Test actual behavior, not mocked behavior\n   \n2. **E2E Integration Tests**: Complete workflow testing\n   - Backup/activate/status cycle\n   - Profile isolation\n   - Lock management\n   - CLI command integration\n   \n3. **Test Infrastructure**\n   - Detailed logging for debugging\n   - Test fixtures and helpers\n   - CI integration\n\n## Philosophy\n- NO mocks/fakes - test real behavior\n- Tests should be runnable in isolation\n- Clear failure messages with context\n- Comprehensive edge case coverage","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-17T01:47:43.240498018-05:00","updated_at":"2025-12-17T01:58:50.964601277-05:00","closed_at":"2025-12-17T01:58:50.964601277-05:00","close_reason":"Test suite infrastructure established: TUI tests (37%), profile tests (82%), authfile tests complete. Pattern set for remaining packages."}
{"id":"caam-9dp","title":"Unit tests for internal/provider/gemini","description":"## Package: internal/provider/gemini\n\nGemini CLI provider implementation.\n\n## What to Test\n- Provider name and display name\n- Settings file path\n- Config directory structure\n- Binary name for exec\n\n## Files to Create\n- internal/provider/gemini/gemini_test.go\n\n## Approach\n- Use t.TempDir() with HOME override\n- Test path construction\n- Verify interface compliance","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-17T01:49:43.54419094-05:00","updated_at":"2025-12-17T01:49:43.54419094-05:00","dependencies":[{"issue_id":"caam-9dp","depends_on_id":"caam-0dy","type":"blocks","created_at":"2025-12-17T01:54:21.220189437-05:00","created_by":"ubuntu"},{"issue_id":"caam-9dp","depends_on_id":"caam-9fd","type":"blocks","created_at":"2025-12-17T01:56:10.593072098-05:00","created_by":"ubuntu"}]}
{"id":"caam-9fd","title":"Unit tests for internal/provider","description":"## Package: internal/provider\n\nProvider interface and registry management.\n\n## What to Test\n- Provider interface contract\n- Registry creation\n- Provider registration\n- Provider lookup by name\n- All() returns all providers\n- Unknown provider handling\n\n## Files to Create\n- internal/provider/provider_test.go\n- internal/provider/registry_test.go\n\n## Approach\n- Create mock-free test provider implementation\n- Test registry operations\n- Verify provider interface compliance","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-17T01:49:16.444043828-05:00","updated_at":"2025-12-17T01:49:16.444043828-05:00","dependencies":[{"issue_id":"caam-9fd","depends_on_id":"caam-0dy","type":"blocks","created_at":"2025-12-17T01:54:05.924055584-05:00","created_by":"ubuntu"}]}
{"id":"caam-a4e","title":"Add sessions list command","description":"## Task\nAdd 'caam sessions' command to show all running caam sessions.\n\n## Output Format\n```\nPROVIDER  PROFILE    PID     STARTED         COMMAND\ncodex     work-1     12345   2h ago          codex\nclaude    personal   12346   30m ago         claude -p ...\ngemini    team       -       (stale lock)    -\n```\n\n## Implementation\n- Scan all profiles across all providers\n- Check lock files\n- Validate PIDs (detect stale)\n- Show command if available (could add to lock file)\n\n## Flags\n- --json: JSON output for scripting\n- --provider: Filter by provider\n\n## Acceptance Criteria\n- Shows all locked profiles\n- Identifies stale locks\n- JSON output works","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T00:53:34.768986551-05:00","updated_at":"2025-12-17T01:35:04.588404136-05:00","closed_at":"2025-12-17T01:35:04.588404136-05:00","close_reason":"Sessions command implemented: shows all locked profiles with PID, status (active/stale), duration. Includes --json and --provider flags.","dependencies":[{"issue_id":"caam-a4e","depends_on_id":"caam-pxg","type":"parent-child","created_at":"2025-12-17T00:53:34.786665006-05:00","created_by":"ubuntu"},{"issue_id":"caam-a4e","depends_on_id":"caam-pb7","type":"blocks","created_at":"2025-12-17T00:53:34.787979761-05:00","created_by":"ubuntu"}]}
{"id":"caam-aek","title":"E2E: Test harness and logging infrastructure","description":"Create reusable test harness with detailed logging:\n\n## Components to Build\n1. TestHarness struct:\n   - TempDir management\n   - Fixture loading\n   - Environment variable management\n   - Cleanup handling\n\n2. Logger interface:\n   - Structured logging (JSON + human readable)\n   - Log levels (DEBUG, INFO, WARN, ERROR)\n   - Timestamps and durations\n   - Test context (name, step, iteration)\n\n3. Fixture helpers:\n   - CreateClaudeAuthFixture()\n   - CreateCodexAuthFixture()\n   - CreateGeminiAuthFixture()\n   - CreateProfileFixture()\n\n4. Assertion helpers:\n   - FileExists(path)\n   - FileContains(path, content)\n   - JSONEquals(path, expected)\n   - DirStructureMatches(path, expected)\n\n## Requirements\n- No external dependencies (use testing.T)\n- Verbose output controlled by -v flag\n- Integration with go test -json for CI","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-17T01:53:12.76462457-05:00","updated_at":"2025-12-17T01:53:12.76462457-05:00","dependencies":[{"issue_id":"caam-aek","depends_on_id":"caam-7a2","type":"blocks","created_at":"2025-12-17T01:55:19.318889376-05:00","created_by":"ubuntu"}]}
{"id":"caam-asu","title":"Unit tests for internal/profile","description":"## Package: internal/profile (CRITICAL)\n\nProfile management - vault and isolation.\n\n## What to Test\n\n### Store Operations\n- NewStore creation\n- Vault directory creation\n- Profile listing per provider\n- Profile existence checking\n\n### Vault Profiles\n- Backup auth to vault\n- Activate from vault\n- Delete vault profile\n- Active profile detection via hash\n\n### Isolated Profiles\n- Create isolated profile directory\n- Profile HOME setup\n- Login flow (directory structure)\n- Exec environment setup\n- Profile deletion\n\n### Lock Management\n- Lock file creation\n- Lock checking\n- Lock release\n- Stale lock detection (PID validation)\n- Force unlock\n\n## Files to Create\n- internal/profile/store_test.go\n- internal/profile/vault_test.go\n- internal/profile/isolated_test.go\n- internal/profile/lock_test.go\n\n## Approach\n- Use t.TempDir() for all directories\n- Create real file structures\n- Test actual file system behavior\n- PID tests may need process spawning","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-17T01:50:08.888362969-05:00","updated_at":"2025-12-17T01:57:02.444888855-05:00","closed_at":"2025-12-17T01:57:02.444888855-05:00","close_reason":"Added 23 unit tests covering 82.3% of profile package. Fixed BrowserDisplayName bug.","dependencies":[{"issue_id":"caam-asu","depends_on_id":"caam-0dy","type":"blocks","created_at":"2025-12-17T01:54:26.325293778-05:00","created_by":"ubuntu"},{"issue_id":"caam-asu","depends_on_id":"caam-7nw","type":"blocks","created_at":"2025-12-17T01:56:15.689630399-05:00","created_by":"ubuntu"}]}
{"id":"caam-by4","title":"Terminal UI (TUI) with Bubble Tea","description":"## Overview\nA visual terminal interface for managing caam profiles. While the CLI is fully functional, a TUI provides:\n- At-a-glance view of all profiles across providers\n- Visual feedback on status (logged in, locked, active)\n- Discoverable interface for new users\n- Running session management\n\n## Design (from original spec)\nLayout:\n- Left panel: Provider list (Codex / Claude / Gemini)\n- Center panel: Profiles table (Name, Auth mode, Logged-in?, Last used, Notes)\n- Right panel: Action pane + detail view for selected profile\n\nKeybindings:\n- ‚Üë/‚Üì: Select profile\n- Enter: Run default command (launch CLI)\n- l: Login/refresh auth\n- o: Open account page in browser\n- e: Edit profile (notes, browser config)\n- d: Delete profile (with confirmation)\n- /: Search/filter profiles\n- Tab: Switch between providers\n- q: Quit\n\n## Implementation\nUse Bubble Tea (bubbletea) with:\n- bubbles for standard components (list, table, textinput)\n- lipgloss for styling\n\n## User Value\n- Visual overview prevents mistakes (wrong account)\n- Running sessions visible prevents data corruption\n- Lower learning curve than CLI-only\n\n## Consideration\nTUI should be the default when running 'caam' with no args, but all functionality must remain available via CLI for scripting.","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-12-17T00:51:16.807075968-05:00","updated_at":"2025-12-17T01:46:22.843793337-05:00","closed_at":"2025-12-17T01:46:22.843793337-05:00","close_reason":"All TUI components implemented: scaffolding (caam-qpx), provider panel (caam-ta7), profiles table (caam-nmm), detail panel (caam-f9h), keyboard navigation (caam-j14). TUI is fully functional with three-panel layout and all keybindings wired up."}
{"id":"caam-ckk","title":"E2E: CLI command workflow tests","description":"End-to-end integration tests for CLI command workflows:\n\n## Test Scenarios\n1. `caam list` - List all profiles across providers\n2. `caam backup \u003cprovider\u003e \u003cemail\u003e` - Backup current auth state\n3. `caam restore \u003cprovider\u003e \u003cemail\u003e` - Restore saved profile\n4. `caam delete \u003cprovider\u003e \u003cemail\u003e` - Delete a saved profile\n5. `caam status` - Show current auth status for all providers\n\n## Requirements\n- Use t.TempDir() for isolated file system tests\n- Real file operations (no mocks)\n- Test actual cobra command execution\n- Detailed logging at each step\n- Test error cases (missing files, invalid profiles)\n\n## Logging Format\nEach test should log:\n- [START] Test name and description\n- [SETUP] Temp directory and fixture creation\n- [EXEC] Command being executed\n- [VERIFY] Expected vs actual results\n- [CLEANUP] Resources cleaned up\n- [PASS/FAIL] Final result with duration","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-17T01:52:40.357727069-05:00","updated_at":"2025-12-17T01:52:40.357727069-05:00","dependencies":[{"issue_id":"caam-ckk","depends_on_id":"caam-7a2","type":"blocks","created_at":"2025-12-17T01:54:53.822477208-05:00","created_by":"ubuntu"},{"issue_id":"caam-ckk","depends_on_id":"caam-aek","type":"blocks","created_at":"2025-12-17T01:55:26.082995053-05:00","created_by":"ubuntu"}]}
{"id":"caam-dw4","title":"Implement 'open' command to open account pages","description":"## Task\nAdd 'caam open' command to open the provider's account management page in the browser.\n\n## Usage\n```bash\ncaam open codex          # Open OpenAI account page\ncaam open claude work-1  # Open Anthropic account page (using work-1's browser config)\ncaam open gemini         # Open Google account page\n```\n\n## Account URLs\n- Codex/OpenAI: https://platform.openai.com/account\n- Claude/Anthropic: https://console.anthropic.com/\n- Gemini/Google: https://myaccount.google.com/ or https://aistudio.google.com/\n\n## Browser Profile Integration\nIf a profile is specified and has browser config, open URL in that browser profile. This ensures you see the correct account's dashboard.\n\n## Implementation\n- Define account URLs per provider\n- Use browser launcher (from browser epic) to open URL\n- If no profile specified, use default browser\n\n## Dependencies\n- Should use browser launcher from browser epic\n- Can work without it (fall back to default browser)\n\n## Acceptance Criteria\n- Opens correct URL for each provider\n- Uses browser profile if configured\n- Falls back to default browser if no config","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-17T00:55:03.513290492-05:00","updated_at":"2025-12-17T01:39:14.018599226-05:00","closed_at":"2025-12-17T01:39:14.018599226-05:00","close_reason":"Implemented caam open command to open provider account pages with browser profile support","dependencies":[{"issue_id":"caam-dw4","depends_on_id":"caam-1ba","type":"parent-child","created_at":"2025-12-17T00:55:03.533449267-05:00","created_by":"ubuntu"},{"issue_id":"caam-dw4","depends_on_id":"caam-4eg","type":"related","created_at":"2025-12-17T00:55:03.534802505-05:00","created_by":"ubuntu"}]}
{"id":"caam-f9h","title":"Implement detail/action panel (right)","description":"## Task\nCreate the right panel showing details and available actions for the selected profile.\n\n## Content\n- Profile details (path, created, last used, browser config)\n- Available actions (Enter to run, l to login, etc.)\n- Help text for keybindings\n\n## Visual Example\n```\n‚îå‚îÄ Profile: work-1 ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ Provider:  Codex                  ‚îÇ\n‚îÇ Auth:      oauth                  ‚îÇ\n‚îÇ Status:    Logged in              ‚îÇ\n‚îÇ Path:      ~/.local/share/caam/...‚îÇ\n‚îÇ Created:   2024-01-15             ‚îÇ\n‚îÇ Last used: 2h ago                 ‚îÇ\n‚îÇ Browser:   Chrome (Profile 2)     ‚îÇ\n‚îÇ                                   ‚îÇ\n‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ     ‚îÇ\n‚îÇ Actions:                          ‚îÇ\n‚îÇ   Enter  Run codex                ‚îÇ\n‚îÇ   l      Login/refresh            ‚îÇ\n‚îÇ   o      Open in browser          ‚îÇ\n‚îÇ   e      Edit profile             ‚îÇ\n‚îÇ   d      Delete                   ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n```\n\n## Acceptance Criteria\n- Shows selected profile details\n- Updates when selection changes\n- Displays available actions","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T00:52:35.3027184-05:00","updated_at":"2025-12-17T01:39:26.867172596-05:00","closed_at":"2025-12-17T01:39:26.867172596-05:00","close_reason":"Implemented detail/action panel with profile details (name, provider, auth mode, status, path, timestamps, account, browser config) and action keybindings display. Integrated into main TUI layout.","dependencies":[{"issue_id":"caam-f9h","depends_on_id":"caam-by4","type":"parent-child","created_at":"2025-12-17T00:52:35.320508134-05:00","created_by":"ubuntu"},{"issue_id":"caam-f9h","depends_on_id":"caam-qpx","type":"blocks","created_at":"2025-12-17T00:52:35.321914232-05:00","created_by":"ubuntu"}]}
{"id":"caam-h6a","title":"Implement 'env' command for shell integration","description":"## Task\nAdd 'caam env' command that prints environment variables for shell eval.\n\n## Usage\n```bash\neval \"$(caam env codex work-1)\"\n# Now CODEX_HOME is set, can run codex directly\n\neval \"$(caam env claude personal)\"\n# Now HOME and XDG_CONFIG_HOME are set\n```\n\n## Output Format\n```bash\nexport CODEX_HOME=\"/home/user/.local/share/caam/profiles/codex/work-1/codex_home\"\n```\n\n## Implementation\n- Get provider env vars from Provider.Env()\n- Format as shell export statements\n- Support --unset to print unset commands\n\n## Use Case\nPower users who want to set up environment once and run multiple commands, rather than using 'caam exec' wrapper each time.\n\n## Acceptance Criteria\n- Outputs valid shell syntax\n- Works with bash/zsh\n- Can be eval'd without errors","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-17T00:54:35.006530391-05:00","updated_at":"2025-12-17T01:37:23.66051241-05:00","closed_at":"2025-12-17T01:37:23.66051241-05:00","close_reason":"Implemented caam env command with --unset and --fish flags for shell integration","dependencies":[{"issue_id":"caam-h6a","depends_on_id":"caam-1ba","type":"parent-child","created_at":"2025-12-17T00:54:35.020449197-05:00","created_by":"ubuntu"}]}
{"id":"caam-hc7","title":"Implement 'use' and 'which' commands for default profiles","description":"## Task\nAdd commands to set and show default profiles per provider.\n\n## `caam use` Command\n```bash\ncaam use codex work-1     # Set work-1 as default for codex\ncaam use claude personal  # Set personal as default for claude\n```\n\nSets the default profile in config. After this, commands that need a profile but don't specify one use the default.\n\n## `caam which` Command\n```bash\ncaam which           # Show defaults for all providers\ncaam which codex     # Show default for codex only\n```\n\nOutput:\n```\ncodex:  work-1\nclaude: personal\ngemini: (none)\n```\n\n## Implementation\n- Add DefaultProfiles map to config (already exists!)\n- use: Update config and save\n- which: Read config and display\n\n## Acceptance Criteria\n- Can set default profile per provider\n- Can view defaults\n- Commands that need profile use default when not specified","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-17T00:54:29.911282188-05:00","updated_at":"2025-12-17T01:37:04.378795755-05:00","closed_at":"2025-12-17T01:37:04.378795755-05:00","close_reason":"Implemented 'caam use' and 'caam which' commands for setting and viewing default profiles per provider.","dependencies":[{"issue_id":"caam-hc7","depends_on_id":"caam-1ba","type":"parent-child","created_at":"2025-12-17T00:54:29.932504866-05:00","created_by":"ubuntu"}]}
{"id":"caam-ixy","title":"Detect and capture localhost redirect URLs from CLI output","description":"## Task\nWhen running login commands (codex login, gemini), capture stdout and detect localhost URLs that need to be opened in a browser.\n\n## Background\nCodex CLI and Gemini CLI print a localhost URL during OAuth setup (e.g., http://localhost:1455/callback?code=...). Currently these auto-open in the default browser. We want to intercept and open in the configured browser profile instead.\n\n## Implementation Approach\n1. Wrap exec.Cmd with custom stdout handling\n2. Use io.TeeReader or similar to both display output AND scan for URLs\n3. Regex pattern: `http://localhost:[0-9]+[^ ]*`\n4. When URL detected, suppress default browser open and use our launcher\n\n## Challenges\n- Some CLIs may use stderr for URLs\n- Need to not break interactive features\n- May need PTY for proper terminal handling\n- Timing: URL may appear briefly before auto-open\n\n## Alternative Approach\nSet BROWSER env var to a wrapper script that calls back to caam. This is cleaner but requires a helper script.\n\n## Acceptance Criteria\n- Can detect localhost URLs from codex login output\n- Can detect localhost URLs from gemini output  \n- Normal CLI output still visible to user\n- Works with both stdout and stderr","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T00:50:31.574510149-05:00","updated_at":"2025-12-17T01:17:41.956736064-05:00","closed_at":"2025-12-17T01:17:41.956736064-05:00","close_reason":"Implemented URL detection for OAuth flows: URLPattern regex, URLDetector io.Writer wrapper, OutputCapture for stdout/stderr, and BROWSER env var helper script generator.","dependencies":[{"issue_id":"caam-ixy","depends_on_id":"caam-4eg","type":"parent-child","created_at":"2025-12-17T00:50:31.58885101-05:00","created_by":"ubuntu"}]}
{"id":"caam-j14","title":"Implement keyboard navigation and actions","description":"## Task\nWire up all keyboard shortcuts to their actions.\n\n## Keybindings\n- q: Quit\n- ‚Üë/‚Üì: Navigate profiles\n- Tab: Switch provider\n- Enter: Run CLI with selected profile\n- l: Login to selected profile\n- o: Open account page in browser (requires browser epic)\n- e: Edit profile\n- d: Delete profile (with confirmation)\n- /: Search/filter mode\n\n## Implementation\n- Handle key events in Update()\n- Dispatch to appropriate actions\n- Show confirmation dialogs for destructive actions\n\n## Dependencies\n- Requires browser epic for 'o' command\n- Edit mode needs separate view state\n\n## Acceptance Criteria\n- All keybindings functional\n- Delete requires confirmation\n- Actions provide visual feedback","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T00:52:40.395351148-05:00","updated_at":"2025-12-17T01:45:17.918666626-05:00","closed_at":"2025-12-17T01:45:17.918666626-05:00","close_reason":"Implemented all keyboard navigation and actions: fixed 'l' key conflict, added Edit (e), Search/filter mode (/), updated help view and detail panel keybindings display","dependencies":[{"issue_id":"caam-j14","depends_on_id":"caam-by4","type":"parent-child","created_at":"2025-12-17T00:52:40.409454362-05:00","created_by":"ubuntu"},{"issue_id":"caam-j14","depends_on_id":"caam-ta7","type":"blocks","created_at":"2025-12-17T00:52:40.410828349-05:00","created_by":"ubuntu"},{"issue_id":"caam-j14","depends_on_id":"caam-nmm","type":"blocks","created_at":"2025-12-17T00:52:40.411813644-05:00","created_by":"ubuntu"}]}
{"id":"caam-j46","title":"Unit tests for internal/passthrough","description":"## Package: internal/passthrough\n\nSymlink passthrough for isolated profiles.\n\n## What to Test\n- Passthrough directory list\n- Symlink creation\n- Target path resolution\n- Missing target handling\n- Existing symlink handling\n- Symlink verification\n\n## Files to Create\n- internal/passthrough/passthrough_test.go\n\n## Approach\n- Use t.TempDir() for test directories\n- Create real symlinks\n- Verify symlink targets\n- Test edge cases (broken links, missing dirs)","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-17T01:50:17.581338667-05:00","updated_at":"2025-12-17T01:50:17.581338667-05:00","dependencies":[{"issue_id":"caam-j46","depends_on_id":"caam-0dy","type":"blocks","created_at":"2025-12-17T01:54:31.424518709-05:00","created_by":"ubuntu"}]}
{"id":"caam-nac","title":"Implement browser launcher abstraction","description":"## Task\nCreate internal/browser/browser.go with a Launcher interface and implementations for different browsers.\n\n## Design\n```go\ntype Launcher interface {\n    // Open opens a URL in the configured browser profile\n    Open(url string) error\n    // Name returns the browser name for display\n    Name() string\n}\n\ntype Config struct {\n    Command    string // Browser executable\n    ProfileDir string // Profile directory or name\n}\n```\n\n## Implementations Needed\n1. ChromeLauncher - uses --profile-directory flag\n2. FirefoxLauncher - uses -P flag for profile name\n3. DefaultLauncher - uses OS default (open/xdg-open)\n\n## Platform Considerations\n- macOS: Chrome is at /Applications/Google Chrome.app/Contents/MacOS/Google Chrome\n- Linux: Usually 'google-chrome' or 'chromium-browser'\n- Windows: Complex paths, need registry lookup or common paths\n\n## Rationale\nAbstraction allows us to support multiple browsers and add new ones easily. The interface also makes testing straightforward.\n\n## Acceptance Criteria\n- Launcher interface defined\n- Chrome implementation works on macOS and Linux\n- Firefox implementation works\n- Default fallback works\n- Unit tests for each implementation","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-17T00:50:26.47883372-05:00","updated_at":"2025-12-17T01:16:04.783685539-05:00","closed_at":"2025-12-17T01:16:04.783685539-05:00","close_reason":"Implemented browser launcher abstraction with Launcher interface, ChromeLauncher (--profile-directory), FirefoxLauncher (-P), DefaultLauncher (xdg-open/open), and GenericLauncher. Includes platform-specific browser detection for macOS/Linux/Windows.","dependencies":[{"issue_id":"caam-nac","depends_on_id":"caam-4eg","type":"parent-child","created_at":"2025-12-17T00:50:26.499689437-05:00","created_by":"ubuntu"}]}
{"id":"caam-nmm","title":"Implement profiles table panel (center)","description":"## Task\nCreate the center panel showing profiles for the selected provider as a table.\n\n## Columns\n- Name (profile name)\n- Auth Mode (oauth, api-key)\n- Status (logged in ‚úì/‚úó, locked üîí)\n- Last Used (relative time)\n- Account (label if set)\n\n## Implementation\n- Use bubbles/table component\n- Filter by active provider\n- Up/down navigation\n- Sorting by last used (most recent first)\n\n## Visual Example\n```\n‚îå‚îÄ Codex Profiles ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ Name          Auth    Status      Last Used   Account  ‚îÇ\n‚îÇ ‚ñ∂ work-1      oauth   ‚úì           2h ago      jeff@... ‚îÇ\n‚îÇ   work-2      oauth   ‚úì           1d ago      bob@...  ‚îÇ\n‚îÇ   personal    api-key ‚úì üîí        now         -        ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n```\n\n## Acceptance Criteria\n- Table shows profiles for selected provider\n- Up/down navigation works\n- Status icons accurate\n- Locked profiles show lock icon","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T00:51:53.73290065-05:00","updated_at":"2025-12-17T01:37:38.990092926-05:00","closed_at":"2025-12-17T01:37:38.990092926-05:00","close_reason":"Implemented profiles table panel with columns for Name, Auth, Status, Last Used. Includes status icons, sort by last used, selection highlighting, and comprehensive tests.","dependencies":[{"issue_id":"caam-nmm","depends_on_id":"caam-by4","type":"parent-child","created_at":"2025-12-17T00:51:53.746797474-05:00","created_by":"ubuntu"},{"issue_id":"caam-nmm","depends_on_id":"caam-qpx","type":"blocks","created_at":"2025-12-17T00:52:10.76287646-05:00","created_by":"ubuntu"}]}
{"id":"caam-pb7","title":"Enhance lock file with PID validation","description":"## Task\nImprove the lock file system to detect stale locks from dead processes.\n\n## Current Lock Format\n```json\n{\"pid\": 12345, \"locked_at\": \"2024-01-15T10:00:00Z\"}\n```\n\n## Enhanced Implementation\n1. Read lock file\n2. Check if PID still exists (os.FindProcess + signal 0)\n3. If process dead, consider lock stale\n4. Optionally auto-clean stale locks\n\n## Platform Considerations\n- Unix: kill(pid, 0) returns error if process doesn't exist\n- Windows: OpenProcess + different error handling\n\n## Code Location\n- internal/profile/profile.go - IsLocked(), Lock(), Unlock()\n- Add: IsLockStale(), CleanStaleLock()\n\n## Acceptance Criteria\n- Can detect if locking process is still running\n- Stale locks reported appropriately\n- Works on Linux and macOS","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T00:53:08.139140246-05:00","updated_at":"2025-12-17T01:24:04.458474061-05:00","closed_at":"2025-12-17T01:24:04.458474061-05:00","close_reason":"Added LockInfo struct, GetLockInfo(), IsProcessAlive(), IsLockStale(), CleanStaleLock(), and LockWithCleanup() methods. The exec runner now uses LockWithCleanup to automatically clean stale locks from dead processes.","dependencies":[{"issue_id":"caam-pb7","depends_on_id":"caam-pxg","type":"parent-child","created_at":"2025-12-17T00:53:29.6771176-05:00","created_by":"ubuntu"}]}
{"id":"caam-pxg","title":"Session Management","description":"## Overview\nEnhance the existing lock file system to provide robust session tracking and prevent data corruption when multiple processes try to use the same profile.\n\n## Current State\n- Basic lock files exist (profile.Lock(), profile.Unlock())\n- Lock files contain simple JSON with PID and timestamp\n\n## Problems to Solve\n1. Stale locks: If a process crashes, the lock remains\n2. No visibility: Can't see what sessions are running\n3. No protection: Operations don't always check locks\n\n## Goals\n- Detect and clean up stale locks (process no longer running)\n- Show running sessions in CLI and TUI\n- Prevent destructive operations on locked profiles\n- Allow force-unlock for stuck locks\n\n## User Value\n- Prevents accidental data corruption\n- Makes it safe to run multiple caam instances\n- Visibility into what's running","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-12-17T00:53:03.044026907-05:00","updated_at":"2025-12-17T01:42:02.293200799-05:00","closed_at":"2025-12-17T01:42:02.293200799-05:00","close_reason":"All child tasks completed: sessions list, lock file PID validation, and force-unlock commands."}
{"id":"caam-qa1","title":"Add --browser flag to profile add command","description":"## Task\nExtend 'caam profile add' to accept browser configuration during profile creation.\n\n## New Flags\n- --browser: Browser type (chrome, firefox, default)\n- --browser-profile: Browser profile name or directory\n\n## Example Usage\n```bash\ncaam profile add codex work --browser chrome --browser-profile 'Profile 2'\ncaam profile add claude personal --browser firefox --browser-profile 'personal-firefox'\n```\n\n## Implementation\n- Add flags to profileAddCmd in cmd/caam/cmd/root.go\n- Pass values to profile.Create()\n- Store in profile.json\n\n## UX Consideration\nCould also support interactive browser selection if flags not provided. List detected Chrome profiles and let user choose.\n\n## Acceptance Criteria\n- Flags accepted and stored in profile\n- Profile loads correctly with browser config\n- Works with existing profiles (backwards compatible)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T00:50:51.770335947-05:00","updated_at":"2025-12-17T01:21:48.713708067-05:00","closed_at":"2025-12-17T01:21:48.713708067-05:00","close_reason":"Added --browser, --browser-profile, and --browser-name flags to 'profile add' command. Profile status now shows browser config.","dependencies":[{"issue_id":"caam-qa1","depends_on_id":"caam-4eg","type":"parent-child","created_at":"2025-12-17T00:50:51.784339072-05:00","created_by":"ubuntu"},{"issue_id":"caam-qa1","depends_on_id":"caam-ypx","type":"blocks","created_at":"2025-12-17T00:50:51.785523973-05:00","created_by":"ubuntu"}]}
{"id":"caam-qpx","title":"Set up Bubble Tea scaffolding and main model","description":"## Task\nCreate the foundational TUI code structure using Bubble Tea.\n\n## Files to Create\n- internal/ui/model.go - Main application model\n- internal/ui/styles.go - Lipgloss styles\n- internal/ui/keys.go - Keybindings\n\n## Main Model Structure\n```go\ntype Model struct {\n    providers    []string           // codex, claude, gemini\n    activeProvider int              // Currently selected provider\n    profiles     map[string][]*profile.Profile\n    selected     int                // Currently selected profile\n    width, height int               // Terminal dimensions\n    state        viewState          // list, detail, confirm, etc.\n    err          error\n}\n```\n\n## Implementation Notes\n- Implement tea.Model interface (Init, Update, View)\n- Handle window resize events\n- Set up basic layout (will be refined in panel tasks)\n- Add dependency: go get github.com/charmbracelet/bubbletea\n\n## Acceptance Criteria\n- TUI launches with 'caam' (no args)\n- Basic model structure in place\n- Handles resize events\n- Can quit with 'q'","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T00:51:43.546283097-05:00","updated_at":"2025-12-17T01:26:57.115215337-05:00","closed_at":"2025-12-17T01:26:57.115215337-05:00","close_reason":"TUI scaffolding complete: model.go, styles.go, keys.go implemented. TUI launches with 'caam' (no args), handles resize, quit with 'q'. Build verified.","dependencies":[{"issue_id":"caam-qpx","depends_on_id":"caam-by4","type":"parent-child","created_at":"2025-12-17T00:51:43.566635847-05:00","created_by":"ubuntu"}]}
{"id":"caam-qvq","title":"Unit tests for cmd/caam/cmd","description":"## Package: cmd/caam/cmd\n\nCLI command implementations.\n\n## What to Test\n- Root command setup\n- Subcommand registration\n- Flag parsing\n- Command execution flow\n- Error handling and exit codes\n- JSON output formatting\n- Help text generation\n\n## Commands to Test\n- backup, activate, status, ls, delete, clear, paths\n- profile add/ls/delete/status/unlock\n- login, exec\n- sessions, doctor, init, env, use, which, open\n\n## Files to Create\n- cmd/caam/cmd/root_test.go\n- cmd/caam/cmd/vault_test.go\n- cmd/caam/cmd/profile_test.go\n- cmd/caam/cmd/misc_test.go\n\n## Approach\n- Use Cobra test utilities\n- Capture stdout/stderr\n- Test with t.TempDir() for data\n- Verify command output\n- Check exit codes","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-17T01:50:49.164096633-05:00","updated_at":"2025-12-17T01:50:49.164096633-05:00","dependencies":[{"issue_id":"caam-qvq","depends_on_id":"caam-0dy","type":"blocks","created_at":"2025-12-17T01:54:46.714953612-05:00","created_by":"ubuntu"}]}
{"id":"caam-rem","title":"Unit tests for internal/exec","description":"## Package: internal/exec\n\nCommand execution runner.\n\n## What to Test\n- Runner creation\n- Environment setup\n- Command building\n- Execution options\n- Lock acquisition during exec\n- Lock release after exec\n- Error handling\n\n## Files to Create\n- internal/exec/runner_test.go\n- internal/exec/env_test.go\n\n## Approach\n- Use simple test commands (echo, true, false)\n- Test environment variable setup\n- Verify lock behavior\n- Test error propagation","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-17T01:50:32.217539074-05:00","updated_at":"2025-12-17T01:50:32.217539074-05:00","dependencies":[{"issue_id":"caam-rem","depends_on_id":"caam-0dy","type":"blocks","created_at":"2025-12-17T01:54:41.614004184-05:00","created_by":"ubuntu"}]}
{"id":"caam-ta7","title":"Implement provider list panel (left)","description":"## Task\nCreate the left panel showing the list of providers (Codex, Claude, Gemini).\n\n## Design\n- Vertical list of providers\n- Currently selected provider highlighted\n- Show count of profiles per provider\n- Tab key cycles through providers\n\n## Implementation\n- Use bubbles/list or custom component\n- Style with lipgloss (border, colors)\n- Connect to main model's activeProvider\n\n## Visual Example\n```\n‚îå‚îÄ Providers ‚îÄ‚îÄ‚îê\n‚îÇ ‚ñ∂ Codex (3)  ‚îÇ\n‚îÇ   Claude (5) ‚îÇ\n‚îÇ   Gemini (2) ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n```\n\n## Acceptance Criteria\n- Shows all three providers\n- Tab key cycles selection\n- Profile counts accurate\n- Visual highlight on selected","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T00:51:48.642239884-05:00","updated_at":"2025-12-17T01:32:43.562092985-05:00","closed_at":"2025-12-17T01:32:43.562092985-05:00","close_reason":"Implemented provider list panel with vertical layout, profile counts, selection highlighting, and integrated into main TUI layout. Added tests.","dependencies":[{"issue_id":"caam-ta7","depends_on_id":"caam-by4","type":"parent-child","created_at":"2025-12-17T00:51:48.656836326-05:00","created_by":"ubuntu"},{"issue_id":"caam-ta7","depends_on_id":"caam-qpx","type":"blocks","created_at":"2025-12-17T00:52:05.677440151-05:00","created_by":"ubuntu"}]}
{"id":"caam-v51","title":"Unit tests for internal/provider/claude","description":"## Package: internal/provider/claude\n\nClaude Code provider implementation.\n\n## What to Test\n- Provider name and display name\n- Auth file paths returned correctly\n- Path expansion (~ handling)\n- Multiple auth file handling\n- File existence checking\n\n## Files to Create\n- internal/provider/claude/claude_test.go\n\n## Approach\n- Use t.TempDir() with HOME override\n- Create fake auth file structure\n- Test path resolution\n- No actual Claude auth needed","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-17T01:49:24.421551392-05:00","updated_at":"2025-12-17T01:49:24.421551392-05:00","dependencies":[{"issue_id":"caam-v51","depends_on_id":"caam-0dy","type":"blocks","created_at":"2025-12-17T01:54:11.011963528-05:00","created_by":"ubuntu"},{"issue_id":"caam-v51","depends_on_id":"caam-9fd","type":"blocks","created_at":"2025-12-17T01:56:00.389147167-05:00","created_by":"ubuntu"}]}
{"id":"caam-vwo","title":"Unit tests for internal/version","description":"## Package: internal/version\n\nSimple version information package - good starting point.\n\n## What to Test\n- Version() returns non-empty string\n- Commit() returns valid commit hash format\n- Date() returns valid date format\n- Full version string formatting\n\n## Files to Create\n- internal/version/version_test.go\n\n## Approach\n- Simple assertions on return values\n- No external dependencies needed","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T01:48:36.267048963-05:00","updated_at":"2025-12-17T01:58:22.879662567-05:00","closed_at":"2025-12-17T01:58:22.879662567-05:00","close_reason":"Implemented 8 unit tests covering Info(), Short(), default values, format structure, determinism, and Go version inclusion","dependencies":[{"issue_id":"caam-vwo","depends_on_id":"caam-0dy","type":"blocks","created_at":"2025-12-17T01:53:50.597811251-05:00","created_by":"ubuntu"}]}
{"id":"caam-y49","title":"Implement 'init' command for guided setup","description":"## Task\nAdd 'caam init' command for first-time setup.\n\n## What it does\n1. Creates data directories (~/.local/share/caam/{vault,profiles})\n2. Creates default config file\n3. Detects installed CLI tools\n4. Optionally walks user through creating first profile\n\n## Interactive Flow\n```\n$ caam init\n\nWelcome to caam - Coding Agent Account Manager!\n\nCreating directories...\n  Created ~/.local/share/caam/vault\n  Created ~/.local/share/caam/profiles\n\nDetecting CLI tools...\n  ‚úì codex found\n  ‚úì claude found\n  ‚úó gemini not found\n\nWould you like to create your first profile? [Y/n]\n\u003e y\n\nWhich tool? (codex/claude/gemini)\n\u003e claude\n\nProfile name (e.g., work, personal, account-1)\n\u003e work\n\nCreated profile claude/work\n\nNext steps:\n  caam login claude work   # Authenticate\n  caam backup claude work  # Save auth to vault\n```\n\n## Flags\n- --quiet: Non-interactive, just create directories\n- --force: Overwrite existing config\n\n## Acceptance Criteria\n- Creates necessary directories\n- Detects installed tools\n- Optional guided profile creation\n- Idempotent (safe to run multiple times)","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-17T00:55:08.611338867-05:00","updated_at":"2025-12-17T01:40:02.199671201-05:00","closed_at":"2025-12-17T01:40:02.199671201-05:00","close_reason":"Implemented 'caam init' command for first-time setup: creates directories, detects CLI tools, shows next steps. Includes --quiet flag.","dependencies":[{"issue_id":"caam-y49","depends_on_id":"caam-1ba","type":"parent-child","created_at":"2025-12-17T00:55:08.625375856-05:00","created_by":"ubuntu"}]}
{"id":"caam-ypx","title":"Add browser profile config to Profile struct","description":"## Task\nAdd fields to the Profile struct (internal/profile/profile.go) to store browser configuration:\n- BrowserCommand: string (e.g., 'google-chrome', 'firefox', or full path)\n- BrowserProfileDir: string (e.g., 'Profile 1' for Chrome, or full path)\n- BrowserProfileName: string (human-friendly name like 'Work Google')\n\n## Rationale\nThese fields allow each caam profile to be associated with a specific browser profile. When OAuth flows need to open a browser, we can launch the correct browser profile that already has the right Google/GitHub account logged in.\n\n## Implementation Notes\n- Add to Profile struct in internal/profile/profile.go\n- Add to JSON serialization\n- Consider making these optional (empty = use system default)\n- Update profile.json schema\n\n## Acceptance Criteria\n- Profile struct has browser config fields\n- Fields serialize/deserialize correctly\n- Existing profiles without these fields still load (backwards compatible)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-17T00:50:00.728787825-05:00","updated_at":"2025-12-17T01:14:47.055352233-05:00","closed_at":"2025-12-17T01:14:47.055352233-05:00","close_reason":"Added BrowserCommand, BrowserProfileDir, BrowserProfileName fields to Profile struct with omitempty tags for backwards compatibility. Added HasBrowserConfig() and BrowserDisplayName() helper methods.","dependencies":[{"issue_id":"caam-ypx","depends_on_id":"caam-4eg","type":"parent-child","created_at":"2025-12-17T00:50:00.742110459-05:00","created_by":"ubuntu"}]}
